<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAGAs Consolidation Tool - IPSAS Financial Reporting System</title>
    <style>
        <?!= include('css/main.css'); ?>
        <?!= include('css/mobile.css'); ?>
    </style>
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <img src="images/kenya-coat-of-arms-placeholder.svg" alt="Kenya Coat of Arms" class="logo-image">
                </div>
                <div class="title-section">
                    <h1 class="system-title">SAGAs Consolidation Tool</h1>
                    <p class="system-subtitle">IPSAS Financial Reporting System</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Login Section -->
            <section class="login-section">
                <div class="login-box">
                    <h2 class="login-title">Login to SAGAs</h2>
                    <form class="login-form" id="loginForm">
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input
                                type="email"
                                id="email"
                                name="email"
                                class="form-input"
                                placeholder="Enter your email"
                                required
                            >
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input
                                type="password"
                                id="password"
                                name="password"
                                class="form-input"
                                placeholder="Enter your password"
                                required
                            >
                        </div>
                        <button type="submit" class="btn-login">Login</button>
                        <div class="form-footer">
                            <a href="#" class="forgot-password">Forgot Password?</a>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Info Section -->
            <section class="info-section">
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">Current Period</div>
                        <div class="info-value">Q2 2024-25</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Submission Deadline</div>
                        <div class="info-value">December 31, 2024</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Entities Submitted</div>
                        <div class="info-value">
                            <span class="submission-count">680/750</span>
                            <span class="submission-percent">(91%)</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p class="footer-text">&copy; 2024 National Treasury of Kenya</p>
                <p class="footer-version">Version 1.0</p>
            </div>
        </div>
    </footer>

    <script>
        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = event.target.querySelector('.btn-login');

            // Disable button
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';

            // Call Google Apps Script function
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        // Redirect to appropriate page based on role
                        window.location.href = '?page=' + result.redirectTo;
                    } else {
                        alert('Login Failed: ' + result.error);
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'Login';
                    }
                })
                .withFailureHandler(function(error) {
                    alert('An error occurred: ' + error.message);
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'Login';
                })
                .handleLogin({ email: email, password: password });
        });

        // Handle forgot password
        document.querySelector('.forgot-password').addEventListener('click', function(event) {
            event.preventDefault();
            const email = prompt('Enter your email address:');
            if (email) {
                google.script.run
                    .withSuccessHandler(function(result) {
                        if (result.success) {
                            alert('Password reset link sent to your email.');
                        } else {
                            alert('Error: ' + result.error);
                        }
                    })
                    .withFailureHandler(function(error) {
                        alert('An error occurred: ' + error.message);
                    })
                    .resetPassword(email);
            }
        });
    </script>
</body>
</html>
